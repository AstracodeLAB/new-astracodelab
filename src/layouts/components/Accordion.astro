---
const { titulo, contenido, className = "" } = Astro.props;
---

<div class={`accordion ${className}`} data-accordion>
  <button class="accordion__header" data-accordion-trigger>
    <span class="accordion__title">{titulo}</span>
    <svg class="accordion__icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
  <div class="accordion__content" data-accordion-content>
    <div class="accordion__text">
      <p set:html={contenido}></p>
    </div>
  </div>
</div>

<script is:inline>
  // FunciÃ³n de inicializaciÃ³n del accordion
  function initializeAccordions() {
    console.log('ðŸ”„ Inicializando accordions...');

    const accordions = document.querySelectorAll('[data-accordion]');

    accordions.forEach(accordion => {
      const trigger = accordion.querySelector('[data-accordion-trigger]');
      const content = accordion.querySelector('[data-accordion-content]');
      const icon = accordion.querySelector('.accordion__icon');

      if (!trigger || !content || !icon) {
        console.error('âŒ Elementos del accordion no encontrados');
        return;
      }

      // Limpiar event listeners previos (evitar duplicados)
      const newTrigger = trigger.cloneNode(true);
      trigger.parentNode.replaceChild(newTrigger, trigger);

      // Set initial state
      content.style.height = '0px';
      content.style.overflow = 'hidden';
      content.style.transition = 'height 0.3s ease';
      icon.style.transition = 'transform 0.3s ease';

      // Restablecer clase si estaba abierta
      accordion.classList.remove('accordion--open');
      icon.style.transform = 'rotate(0deg)';

      newTrigger.addEventListener('click', () => {
        const isOpen = accordion.classList.contains('accordion--open');

        if (isOpen) {
          // Close
          content.style.height = '0px';
          accordion.classList.remove('accordion--open');
          icon.style.transform = 'rotate(0deg)';
        } else {
          // Open
          const scrollHeight = content.scrollHeight;
          content.style.height = scrollHeight + 'px';
          accordion.classList.add('accordion--open');
          icon.style.transform = 'rotate(180deg)';
        }
      });
    });

    console.log('âœ… Accordions inicializados correctamente');
  }

  // Initialize when DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAccordions);
  } else {
    initializeAccordions();
  }

  // Re-initialize after Astro page transitions
  document.addEventListener('astro:page-load', initializeAccordions);
  document.addEventListener('astro:after-swap', initializeAccordions);
</script>