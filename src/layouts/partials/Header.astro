---
import Buttons from '../components/Buttons/Buttons.astro';
import Logo from '../components/Logo.astro';
---

<header class='header header__text'>
  <nav class='navigation' aria-label='Menú principal'>
    <div class='navigation__container'>
      <!-- Logo -->
      <div class='navigation__container-logo'>
        <Logo />
      </div>

      <!-- Botón hamburguesa (móvil) -->
      <button
        id='nav-toggle'
        class='navigation__container-button navigation__container-button--open'
        aria-expanded='false'
        aria-controls='nav-menu'
        aria-label='Abrir menú'
      >
        <svg class='navigation__container-button-icon' viewBox='0 0 20 20'>
          <title>Abrir menú</title>
          <path d='M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z'></path>
        </svg>
      </button>

      <!-- Menú principal -->
      <ul id='nav-menu' class='navigation__container-menu' aria-hidden='true'>
        <!-- Botón cerrar dentro del menú móvil -->
        <li class='navigation__container-menu-item navigation__container-menu-item-close'>
          <button class='navigation__container-button navigation__container-button--close' aria-label='Cerrar menú'>
            <svg class='navigation__container-button-icon' viewBox='0 0 20 20'>
              <title>Cerrar menú</title>
              <polygon
                points='11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2'
                transform='rotate(45 10 10)'></polygon>
            </svg>
          </button>
        </li>

        <!-- Mega menú -->
        <li class='navigation__container-menu-itemsMap'>
          <button
            class='navigation__container-menu-itemsMap-link'
            aria-expanded='false'
            aria-controls='submenu-services'
          >
            Servicios
            <svg
              class='navigation__container-menu-itemsMap-arrow'
              viewBox='0 0 20 20'
              xmlns='http://www.w3.org/2000/svg'
            >
              <path d='M5 7l5 5 5-5H5z'></path>
            </svg>
          </button>

          <div id='submenu-services' class='navigation__container-megamenu' aria-hidden='true'>
            <div class='megamenu-column'>
              <h3>Diseño y desarrollo web</h3>
              <a href='/servicios/web-corporativa'>Web corporativa</a>
              <a href='/servicios/tienda-online'>Tienda online / e-commerce</a>
              <a href='/servicios/landing-page'>Landing pages</a>
              <a href='/servicios/redisenio-web'>Rediseño web</a>
            </div>
            <div class='megamenu-column'>
              <h3>Funcionalidades y Optimización</h3>
              <a href='/servicios/web-multilingue'>Web multilingüe</a>
              <a href='/servicios/sistemas-de-reservas'>Sistemas de reservas</a>
              <a href='/servicios/accesibilidad-web'>Accesibilidad web</a>
              <a href='/servicios/cartas-digitales'>Cartas digitales para restaurantes</a>
            </div>
            <div class='megamenu-column'>
              <h3>Mantenimiento y soporte</h3>
              <a href='/servicios/mantenimiento-web'>Mantenimiento web</a>
              <a href='/servicios/hosting-dominio'>Hosting y dominio</a>
            </div>
          </div>
        </li>

        <li class='navigation__container-menu-itemsMap'>
          <a href='/#contact' class='navigation__container-menu-itemsMap-link'>Astracodelab</a>
        </li>

        <li class='navigation__container-menu-itemsMap'>
          <a href='/#projects' class='navigation__container-menu-itemsMap-link'>Contacto</a>
        </li>

        <!-- <li class='navigation__container-menu-itemsMap'>
          <a href='/#about' class='navigation__container-menu-itemsMap-link'>Blog</a>
        </li> -->
        <li class='navigation__container-menu-itemsMap cta-mobile'>
          <Buttons href='/#contact' className='btnPrimaryLight'>¿Hablamos?</Buttons>
        </li>
      </ul>

      <div class='button-header'>
        <Buttons href='/#contact' className='btnPrimaryLight'>¿Hablamos?</Buttons>
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navToggle = document.getElementById('nav-toggle');
    const navMenu = document.getElementById('nav-menu');
    const closeBtn = navMenu.querySelector('.navigation__container-button--close');

    const toggleMenu = (open) => {
      const expanded = open ? 'true' : 'false';
      navToggle.setAttribute('aria-expanded', expanded);
      navMenu.setAttribute('aria-hidden', open ? 'false' : 'true');
      navMenu.style.display = open ? 'block' : 'none';
    };

    navToggle.addEventListener('click', () => {
      const isOpen = navToggle.getAttribute('aria-expanded') === 'true';
      toggleMenu(!isOpen);
    });

    closeBtn.addEventListener('click', () => {
      toggleMenu(false);
    });

    // Controlar menú móvil con teclado
    navToggle.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        navToggle.click();
      }
    });

    // Mega menú accesible
    const serviceBtn = document.querySelector('[aria-controls="submenu-services"]');
    const submenu = document.getElementById('submenu-services');
    const arrowIcon = serviceBtn.querySelector('svg');

    const toggleSubmenu = (open) => {
      const expanded = open ? 'true' : 'false';
      serviceBtn.setAttribute('aria-expanded', expanded);
      submenu.setAttribute('aria-hidden', open ? 'false' : 'true');
      submenu.style.display = open ? 'flex' : 'none';
      arrowIcon.style.transform = open ? 'rotate(180deg)' : 'rotate(0deg)';
    };

    serviceBtn.addEventListener('click', () => {
      const isOpen = serviceBtn.getAttribute('aria-expanded') === 'true';
      toggleSubmenu(!isOpen);
    });

    serviceBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        serviceBtn.click();
      }
    });

    // Cierra mega menú al hacer clic fuera
    document.addEventListener('click', (e) => {
      if (!serviceBtn.contains(e.target) && !submenu.contains(e.target)) {
        toggleSubmenu(false);
      }
    });
  });
</script>
