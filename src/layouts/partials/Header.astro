---
import Buttons from '../components/Buttons/Buttons.astro';
import Logo from '../components/Logo.astro';
---

<header class='header header__text'>
  <nav class='navigation' aria-label='MenÃº principal'>
    <div class='navigation__container'>
      <!-- Logo -->
      <div class='navigation__container-logo'>
        <Logo />
      </div>

      <!-- BotÃ³n hamburguesa (mÃ³vil) -->
      <button
        id='nav-toggle'
        class='navigation__container-button navigation__container-button--open'
        aria-expanded='false'
        aria-controls='nav-menu'
        aria-label='Abrir menÃº'
        type='button'
      >
        <svg class='navigation__container-button-icon' viewBox='0 0 20 20'>
          <title>Abrir menÃº</title>
          <path d='M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z'></path>
        </svg>
      </button>

      <!-- MenÃº principal -->
      <ul id='nav-menu' class='navigation__container-menu' aria-hidden='true' hidden>
        <!-- BotÃ³n cerrar dentro del menÃº mÃ³vil -->
        <li class='navigation__container-menu-item navigation__container-menu-item-close'>
          <button
            class='navigation__container-button navigation__container-button--close'
            aria-label='Cerrar menÃº'
            type='button'
            id='close-menu'
          >
            <svg class='navigation__container-button-icon' viewBox='0 0 20 20'>
              <title>Cerrar menÃº</title>
              <polygon
                points='11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2'
                transform='rotate(45 10 10)'></polygon>
            </svg>
          </button>
        </li>

        <!-- Mega menÃº -->
        <li class='navigation__container-menu-itemsMap'>
          <button
            id='services-btn'
            class='navigation__container-menu-itemsMap-link'
            aria-expanded='false'
            aria-controls='submenu-services'
            type='button'
          >
            Servicios
            <svg
              id='services-arrow'
              class='navigation__container-menu-itemsMap-arrow'
              viewBox='0 0 20 20'
              xmlns='http://www.w3.org/2000/svg'
            >
              <path d='M5 7l5 5 5-5H5z'></path>
            </svg>
          </button>

          <div id='submenu-services' class='navigation__container-megamenu' aria-hidden='true' hidden>
            <div class='megamenu-column'>
              <h3><a href='/servicios/diseno-web/'>DiseÃ±o y desarrollo web</a></h3>
              <ul>
                <li><a href='/servicios/web-corporativa/'>Web corporativa</a></li>
                <li><a href='/servicios/tienda-online/'>Tienda online / e-commerce</a></li>
                <li><a href='/servicios/landing-page/'>Landing pages</a></li>
                <li><a href='/servicios/redisenio-web/'>RediseÃ±o web</a></li>
              </ul>
            </div>
            <div class='megamenu-column'>
              <h3><a href='/servicios/funcionalidades-optimizacion-web/'>Funcionalidades y OptimizaciÃ³n</a></h3>
              <ul>
                <li><a href='/servicios/web-multilingue/'>Web multilingÃ¼e</a></li>
                <li><a href='/servicios/sistemas-de-reservas/'>Sistemas de reservas</a></li>
                <li><a href='/servicios/accesibilidad-web/'>Accesibilidad web</a></li>
                <li><a href='/servicios/cartas-digitales-restaurantes/'>Cartas digitales para restaurantes</a></li>
              </ul>
            </div>
            <div class='megamenu-column'>
              <h3>Mantenimiento y soporte</h3>
              <ul>
                <li><a href='/servicios/mantenimiento-web/'>Mantenimiento web</a></li>
                <li><a href='/servicios/hosting-dominio/'>Hosting y dominio</a></li>
              </ul>
            </div>
          </div>
        </li>

        <li class='navigation__container-menu-itemsMap'>
          <a href='/sobre-nosotras/' class='navigation__container-menu-itemsMap-link'>Astracodelab</a>
        </li>

        <li class='navigation__container-menu-itemsMap'>
          <a href='/contacto/' class='navigation__container-menu-itemsMap-link'>Contacto</a>
        </li>

        <!-- <li class='navigation__container-menu-itemsMap'>
          <a href='/blog/1/' class='navigation__container-menu-itemsMap-link'>Blog</a>
        </li> -->

        <li class='navigation__container-menu-itemsMap cta-mobile'>
          <Buttons
            href='https://wa.me/34623752940'
            target='_blank'
            rel='noopener noreferrer'
            className='btnPrimaryLight'>Â¿Hablamos?</Buttons
          >
        </li>
      </ul>

      <div class='button-header'>
        <Buttons href='https://wa.me/34623752940' target='_blank' rel='noopener noreferrer' className='btnPrimaryLight'
          >Â¿Hablamos?</Buttons
        >
      </div>
    </div>
  </nav>
</header>

<script is:inline>
  if (!window.navigationInitialized) {
    window.navigationInitialized = true;

    const initializeNavigation = () => {
      console.log('ðŸ”„ Inicializando navegaciÃ³n...');

      const navToggle = document.getElementById('nav-toggle');
      const navMenu = document.getElementById('nav-menu');
      const closeBtn = document.getElementById('close-menu');
      const servicesBtn = document.getElementById('services-btn');
      const submenu = document.getElementById('submenu-services');
      const arrowIcon = document.getElementById('services-arrow');

      if (!navToggle || !navMenu || !servicesBtn || !submenu) {
        console.error('âŒ No se encontraron elementos del menÃº');
        return;
      }

      let isMenuOpen = false;
      let isSubmenuOpen = false;

      const toggleMenu = (open) => {
        isMenuOpen = open;
        navToggle.setAttribute('aria-expanded', open);
        navMenu.setAttribute('aria-hidden', !open);
        open ? navMenu.removeAttribute('hidden') : navMenu.setAttribute('hidden', '');
      };

      const toggleSubmenu = (open) => {
        isSubmenuOpen = open;
        servicesBtn.setAttribute('aria-expanded', open);
        submenu.setAttribute('aria-hidden', !open);
        open ? submenu.removeAttribute('hidden') : submenu.setAttribute('hidden', '');
        arrowIcon.style.transform = open ? 'rotate(180deg)' : 'rotate(0deg)';
      };

      navToggle.addEventListener('click', () => toggleMenu(!isMenuOpen));
      closeBtn.addEventListener('click', () => toggleMenu(false));
      servicesBtn.addEventListener('click', () => toggleSubmenu(!isSubmenuOpen));

      document.addEventListener('click', (e) => {
        if (isSubmenuOpen && !submenu.contains(e.target) && !servicesBtn.contains(e.target)) {
          toggleSubmenu(false);
        }
        if (isMenuOpen && !navMenu.contains(e.target) && !navToggle.contains(e.target)) {
          toggleMenu(false);
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          toggleSubmenu(false);
          toggleMenu(false);
        }
      });

      const navLinks = navMenu.querySelectorAll('a[href^="/"]');
      navLinks.forEach((link) => {
        link.addEventListener('click', () => {
          toggleMenu(false);
          toggleSubmenu(false);
        });
      });

      console.log('âœ… NavegaciÃ³n inicializada correctamente');
    };

    document.addEventListener('astro:page-load', initializeNavigation);
    document.addEventListener('astro:after-swap', initializeNavigation);
    document.addEventListener('DOMContentLoaded', initializeNavigation);
  }
</script>
